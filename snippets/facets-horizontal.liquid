{% comment %}
  水平排列产品系列筛选器
  Accepts:
      - id {String} !required
      - results {Object} 筛选对象
      - has_active: {Boolean} 是否有已激活 facet
      - enable_filtering: {Boolean} 是否启用筛选
      - enable_sorting: {Boolean} 是否启用排序
  Usage:
      {% render 'facets-horizontal', id: 'id', results: results, results_url: 'results_url' %}
{% endcomment %}
{% liquid
  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif
%}

{%- unless results.filters == blank -%}
  <facet-filters-form class="facets">
    <form>
      {% comment %} 关键词 {% endcomment %}
      {%- if results.terms -%}
        <input type="hidden" name="q" value="{{ results.terms | escape }}">
        <input name="options[prefix]" type="hidden" value="last">
      {%- endif -%}
      {% if results.current_vendor or results.current_type %}
        <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
      {% endif %}
      <div id="Facet-Horizontal-Wrapper" class="facet-wrapper facet-horizontal-wrapper">
        {%- if enable_filtering -%}
          <div class="facets-active small-hide mb-2">
            {%- if has_active -%}
              <div class="facets-active-values">
                {%- for filter in results.filters -%}
                  {% if filter.type == 'price_range' %}
                    {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                      <facet-remove>
                        <a
                          href="{{ filter.url_to_remove }}"
                          class="active-facet-value"
                          aria-label="{{ 'products.facets.clear_filter' | t }}"
                        >
                          {%- if filter.min_value.value -%}
                            {{ filter.min_value.value | money }}
                          {%- else -%}
                            {{ 0 | money }}
                          {%- endif -%}
                          -
                          {%- if filter.max_value.value -%}
                            {{ filter.max_value.value | money }}
                          {%- else -%}
                            {{ filter.range_max | money }}
                          {%- endif -%}
                          {% render 'icon-sets', icon: 'close' %}
                        </a>
                      </facet-remove>
                    {%- endif -%}
                  {%- else -%}
                    {%- for value in filter.active_values -%}
                      <facet-remove>
                        <a href="{{ value.url_to_remove }}" class="active-facet-value">
                          {%- if value.swatch != blank -%}
                            <span class="active-facet-color media" style="background: {{ value.swatch.color }};">
                              {%- if value.swatch.image != blank -%}
                                {{ value.swatch.image | image_url: width: 100 | image_tag: loading: 'lazy' }}
                              {%- endif -%}
                            </span>
                          {%- else -%}
                            {{ filter.label }}:
                          {%- endif -%}
                          {{ value.label | escape }}
                          {% render 'icon-sets', icon: 'close' %}
                        </a>
                      </facet-remove>
                    {%- endfor -%}
                  {% endif %}
                {%- endfor -%}
                <facet-remove class="clear-all">
                  <a href="{{ results_url }}" class="link link-text light">
                    {{ 'products.facets.clear_all' | t }}
                  </a>
                </facet-remove>
              </div>
              <div class="facets-active-count light">
                {%- if results.results_count -%}
                  {{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
                {%- elsif results.products_count == results.all_products_count -%}
                  {{ 'products.facets.product_count_simple' | t: count: results.products_count }}
                {%- else -%}
                  {{
                    'products.facets.product_count'
                    | t: product_count: results.products_count, count: results.all_products_count
                  }}
                {%- endif -%}
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}
        <div class="facets-main">
          {%- if enable_filtering -%}
            <div id="Filter-Horizontal-Area" class="facet-filtering">
              {%- for filter in results.filters -%}
                {%- case filter.type -%}
                  {%- when 'boolean', 'list' -%}
                    <drop-menu
                      class="facet-item small-hide"
                      data-area="#Filter-Horizontal-Area"
                      data-index="{{ forloop.index }}"
                    >
                      <details class="drop-menu" data-constrain data-adjust>
                        <summary
                          class="facets-summary drop-menu-button"
                          aria-label="{{ filter.label }} ({{ 'products.facets.filters_selected' | t: count: filter.active_values.size }})"
                        >
                          {% liquid
                            assign swatch_value = blank

                            for value in filter.values
                              if value.swatch != blank
                                assign swatch_value = value
                                break
                              endif
                            endfor
                          %}
                          {%- if swatch_value != blank -%}
                            <span class="media" style="background: {{ swatch_value.swatch.color }};">
                              {%- if swatch_value.swatch.image != blank -%}
                                {{ swatch_value.swatch.image | image_url: width: 100 | image_tag: loading: 'lazy' }}
                              {%- endif -%}
                            </span>
                          {%- endif -%}

                          {{- filter.label | escape }}
                          {% render 'icon-sets', icon: 'caret' %}
                        </summary>
                        <div
                          class="facet-display drop-menu-wrapper color-{{ settings.main_color_scheme }} gradient"
                          tabindex="-1"
                        >
                          <div class="facet-display-header">
                            <span class="facets-selected no-js-hidden">
                              {{- 'products.facets.filters_selected' | t: count: filter.active_values.size -}}
                            </span>
                            <facet-remove>
                              <a href="{{ filter.url_to_remove }}" class="facet-reset link link-text light">
                                {{ 'products.facets.reset' | t }}
                              </a>
                            </facet-remove>
                          </div>
                          <fieldset class="facet-display-content" aria-label="{{ filter.label | escape }}">
                            <expandable-container
                              id="Expandable-Vertical-Filter-{{ forloop.index }}"
                              data-limit-height
                              style="--limit-height: 15rem"
                            >
                              <ul class="content-main list-unstyled{% if filter.presentation != false %} list-type-{{ filter.presentation }}{% endif %}">
                                {%- for value in filter.values -%}
                                  <li class="list-menu-item checkbox">
                                    <label
                                      for="Filter-{{ filter.param_name | escape }}-{{ forloop.index }}"
                                      class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}"
                                      tabindex="0"
                                    >
                                      <input
                                        id="Filter-{{ filter.param_name | escape }}-{{ forloop.index }}"
                                        type="checkbox"
                                        name="{{ value.param_name }}"
                                        value="{{ value.value }}"
                                        {% if value.active %}
                                          checked
                                        {% endif %}
                                        {% if value.count == 0 and value.active == false %}
                                          disabled
                                        {% endif %}
                                      >
                                      <span class="input-face">
                                        <span
                                          {% if value.swatch != blank %}
                                            class="media" style="background: {{ value.swatch.color }};"
                                          {% endif %}
                                        >
                                          {%- if value.swatch.image != blank -%}
                                            {{
                                              value.swatch.image
                                              | image_url: width: 100
                                              | image_tag: loading: 'lazy'
                                            }}
                                          {%- endif -%}
                                        </span>
                                      </span>
                                      <span aria-hidden="true">{{ value.label | escape }} ({{ value.count }})</span>
                                      <span class="visually-hidden">
                                        {{- value.label | escape }} (
                                        {{- 'products.facets.product_count_simple' | t: count: value.count -}}
                                        )
                                      </span>
                                    </label>
                                  </li>
                                {%- endfor -%}
                              </ul>
                              <div class="expand-button-wrapper">
                                <button
                                  type="button"
                                  class="expand-button button--clear link link-text show-underline"
                                  aria-controls="Expandable-Vertical-Filter-{{ forloop.index }}"
                                  aria-expanded="false"
                                >
                                  <span class="read-more-text">
                                    {{ 'general.read_more' | t }}
                                  </span>
                                  <span class="read-less-text hidden">
                                    {{ 'general.read_less' | t }}
                                  </span>
                                </button>
                              </div>
                            </expandable-container>
                          </fieldset>
                        </div>
                      </details>
                    </drop-menu>
                  {%- when 'price_range' -%}
                    {% comment %} 价格筛选 {% endcomment %}
                    <drop-menu
                      class="facet-item small-hide"
                      data-area="#Filter-Horizontal-Area"
                      data-index="{{ forloop.index }}"
                    >
                      <details class="drop-menu" data-constrain data-adjust>
                        <summary class="facets-summary drop-menu-button">
                          <span>{{ localization.country.currency.symbol }}</span>
                          <span>{{ filter.label | escape }}</span>
                          {% render 'icon-sets', icon: 'caret' %}
                        </summary>
                        <div
                          class="facet-display drop-menu-wrapper color-{{ settings.main_color_scheme }} gradient"
                          tabindex="-1"
                        >
                          <div class="drop-menu-list">
                            <div class="facet-display-header">
                              {%- assign max_price_amount = filter.range_max | money | strip_html | escape -%}
                              <span class="facets-selected">
                                {{- 'products.facets.max_price' | t: price: max_price_amount -}}
                              </span>
                              <facet-remove>
                                <a href="{{ filter.url_to_remove }}" class="facet-reset link link-text light">
                                  {{ 'products.facets.reset' | t }}
                                </a>
                              </facet-remove>
                            </div>
                            <div class="facet-display-content pt-2">
                              {% render 'facets-price-range', id: id, filter: filter %}
                            </div>
                          </div>
                        </div>
                      </details>
                    </drop-menu>
                {%- endcase -%}
              {%- endfor -%}
            </div>
          {%- endif -%}
          {%- if enable_sorting -%}
            <div class="facet-sorting">
              <div class="facet-filters-field">
                <label for="Sort-By" class="visually-hidden">{{ 'products.facets.sort_by_label' | t }}</label>
                <div class="select">
                  {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
                  <select
                    id="Sort-By"
                    class="select-select"
                    name="sort_by"
                    aria-describedby="a11y-refresh-page-message"
                  >
                    {%- for option in results.sort_options -%}
                      <option
                        value="{{ option.value | escape }}"
                        {% if option.value == sort_by %}
                          selected="selected"
                        {% endif %}
                      >
                        {{ option.name | escape }}
                      </option>
                    {%- endfor -%}
                  </select>
                  <span class="field-button">
                    {% render 'icon-sets', icon: 'caret' %}
                  </span>
                </div>
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
    </form>
  </facet-filters-form>
{%- endunless -%}
